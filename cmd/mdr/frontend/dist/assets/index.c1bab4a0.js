(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const g of s.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&o(g)}).observe(document,{childList:!0,subtree:!0});function n(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerpolicy&&(s.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?s.credentials="include":a.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(a){if(a.ep)return;a.ep=!0;const s=n(a);fetch(a.href,s)}})();function ue(){return window.go.main.App.GetAutoReload()}function fe(){return window.go.main.App.GetFontScale()}function me(){return window.go.main.App.GetLaunchArgs()}function ge(){return window.go.main.App.GetPalette()}function pe(){return window.go.main.App.GetSearchCaseSensitive()}function ve(){return window.go.main.App.GetTOCPinned()}function ye(){return window.go.main.App.GetTOCVisible()}function we(){return window.go.main.App.GetTheme()}function oe(){return window.go.main.App.ListThemes()}function Ce(e){return window.go.main.App.NavigateSearch(e)}function be(e,t){return window.go.main.App.OpenAndRender(e,t)}function Se(e,t,n){return window.go.main.App.RenderFileWithPaletteAndTOC(e,t,n)}function Ee(e,t){return window.go.main.App.SearchDocument(e,t)}function xe(e){return window.go.main.App.SetAutoReload(e)}function O(e){return window.go.main.App.SetFontScale(e)}function ie(e){return window.go.main.App.SetPalette(e)}function Le(e){return window.go.main.App.SetSearchCaseSensitive(e)}function Te(e){return window.go.main.App.SetTOCPinned(e)}function ke(e){return window.go.main.App.SetTOCVisible(e)}function ae(e){return window.go.main.App.SetTheme(e)}function B(e){return window.go.main.App.StartWatchingFile(e)}function Ae(){return window.go.main.App.StopWatchingFile()}function Ie(e,t,n){return window.runtime.EventsOnMultiple(e,t,n)}function P(e,t){return Ie(e,t,-1)}document.querySelector("#app").innerHTML=`
  <div class="shell">
    <header class="toolbar">
      <div class="brand">mdr</div>
      <div class="controls">
        <button id="tocToggle" class="btn" title="Toggle Table of Contents">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M0 2h16v2H0V2zm0 5h16v2H0V7zm0 5h16v2H0v-2z"/>
          </svg>
        </button>
        <div class="font">
          <button id="fontDec" class="btn" title="Decrease font size">A-</button>
          <div id="fontVal" class="fontVal">100%</div>
          <button id="fontInc" class="btn" title="Increase font size">A+</button>
        </div>
        <select id="theme" class="select">
          <option value="default">default</option>
        </select>
        <select id="palette" class="select">
          <option value="light">light</option>
          <option value="dark">dark</option>
          <option value="theme">theme</option>
        </select>
        <label class="auto-reload-label" title="Auto-reload file on changes">
          <input type="checkbox" id="autoReload" class="auto-reload-checkbox">
          Auto-reload
        </label>
        <button id="open" class="btn">Open\u2026</button>
      </div>
      <div id="path" class="path"></div>
    </header>
    <main class="content">
      <aside id="tocSidebar" class="toc-sidebar">
        <div class="toc-header">
          <span>Table of Contents</span>
          <button id="tocPin" class="toc-pin-btn" title="Pin sidebar">
            <svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
              <path d="M4 9h8v1H4zm0-3h8v1H4zm0-3h8v1H4z"/>
            </svg>
          </button>
        </div>
        <nav id="tocNav" class="toc-nav"></nav>
      </aside>
      <iframe id="preview" class="preview"></iframe>
    </main>
    <footer class="status-bar">
      <div id="status" class="status">Ready</div>
    </footer>
  </div>
  
  <!-- Search Interface -->
  <div id="searchBar" class="search-bar" style="display: none;">
    <div class="search-controls">
      <input type="text" id="searchInput" class="search-input" placeholder="Search in document... (/)">
      <div class="search-info">
        <span id="searchResults" class="search-results"></span>
      </div>
      <div class="search-buttons">
        <button id="searchPrev" class="search-btn" title="Previous match (Shift+F3)">\u2191</button>
        <button id="searchNext" class="search-btn" title="Next match (F3)">\u2193</button>
        <label class="search-case-label" title="Case sensitive (Ctrl+Shift+F)">
          <input type="checkbox" id="searchCaseSensitive" class="search-case-checkbox">
          Aa
        </label>
        <button id="searchClose" class="search-close-btn" title="Close (Esc)">\u2715</button>
      </div>
    </div>
  </div>
`;const v=document.getElementById("theme"),C=document.getElementById("palette"),q=document.getElementById("open"),Y=document.getElementById("path"),d=document.getElementById("preview");document.getElementById("status");const U=document.getElementById("fontDec"),_=document.getElementById("fontInc"),ee=document.getElementById("fontVal"),K=document.getElementById("autoReload"),Oe=document.getElementById("tocToggle"),p=document.getElementById("tocSidebar"),V=document.getElementById("tocNav"),L=document.getElementById("tocPin"),r=document.querySelector(".status-bar"),te=document.getElementById("status"),ce=document.getElementById("searchBar"),b=document.getElementById("searchInput"),k=document.getElementById("searchResults"),Fe=document.getElementById("searchPrev"),De=document.getElementById("searchNext"),Pe=document.getElementById("searchClose"),D=document.getElementById("searchCaseSensitive"),Ne=navigator.platform.toUpperCase().indexOf("MAC")>=0,c=Ne?"metaKey":"ctrlKey";d&&(d.setAttribute("sandbox","allow-same-origin allow-scripts"),d.setAttribute("referrerpolicy","no-referrer"),d.setAttribute("allow",""));let h="",u=100,w=!1,T=!1,S=!1,W=[],A=!1,f=[],l=-1,ne=null;function J(e){const t=!e;U&&(U.disabled=t),_&&(_.disabled=t),v&&(v.disabled=t),C&&(C.disabled=t),q&&(q.disabled=t)}function i(e,t){const n=e||"info",o=t||"";r&&(r.dataset.level=n),te&&(te.textContent=o)}function j(e){if(!e)return"Unknown error";if(typeof e=="string")return e;if(e.message)return e.message;try{return JSON.stringify(e)}catch{return String(e)}}function E(){ee&&(ee.textContent=`${u}%`)}function re(){A=!0,ce.style.display="block",b.focus(),b.select(),i("info","Search opened")}function H(){A=!1,ce.style.display="none",b.value="",k.textContent="",f=[],l=-1,F(),i("info","Search closed")}function F(){try{d.contentWindow.document.querySelectorAll(".search-highlight, .search-highlight-current").forEach(n=>{const o=n.parentNode;for(;n.firstChild;)o.insertBefore(n.firstChild,n);o.removeChild(n)})}catch(e){console.error("Failed to clear search highlights:",e)}}function Q(e){if(!e||!h){F(),k.textContent="",f=[],l=-1;return}clearTimeout(ne),ne=setTimeout(async()=>{try{const t=D.checked,n=await Ee(e,t);f=n.matches||[],l=n.currentIndex||0,f.length===0?(k.textContent="No matches",F()):(k.textContent=`${l+1} of ${f.length}`,$e())}catch(t){console.error("Search error:",t),k.textContent="Search failed",F()}},300)}function $e(){if(f.length!==0)try{let s=function(g){if(g.nodeType===Node.TEXT_NODE){const y=g.textContent;if(!a.test(y))return;a.lastIndex=0;const N=[];let x;for(;(x=a.exec(y))!==null;)N.push({start:x.index,end:x.index+x[0].length,text:x[0]});if(N.length===0)return;const $=t.createDocumentFragment();let I=0;N.forEach((M,he)=>{M.start>I&&$.appendChild(t.createTextNode(y.slice(I,M.start)));const R=t.createElement("mark");R.className="search-highlight",he===l&&R.classList.add("search-highlight-current"),R.textContent=M.text,$.appendChild(R),I=M.end}),I<y.length&&$.appendChild(t.createTextNode(y.slice(I))),g.parentNode.replaceChild($,g)}else if(g.nodeType===Node.ELEMENT_NODE){const y=g.tagName.toLowerCase();if(["script","style","pre","code"].includes(y))return;Array.from(g.childNodes).forEach(x=>s(x))}};var e=s;const t=d.contentWindow.document;F();const n=b.value;if(!n)return;const o=D.checked?"g":"gi",a=new RegExp(Me(n),o);if(s(t.body),l>=0&&l<f.length){const g=f[l];setTimeout(()=>{const y=t.querySelector(".search-highlight-current");y&&y.scrollIntoView({behavior:"smooth",block:"center"})},50)}}catch(t){console.error("Failed to highlight search results:",t)}}function Me(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}async function z(e){if(f.length!==0){try{l=(await Ce(e)).currentIndex}catch(t){console.error("Failed to navigate search:",t),e==="next"?(l++,l>=f.length&&(l=0)):e==="prev"&&(l--,l<0&&(l=f.length-1))}f.length>0&&(k.textContent=`${l+1} of ${f.length}`,Re()),i("info",`Match ${l+1} of ${f.length}`)}}function Re(){try{const e=d.contentWindow.document,t=e.querySelectorAll(".search-highlight");t.forEach(n=>{n.classList.remove("search-highlight-current")}),l>=0&&l<t.length&&(t[l].classList.add("search-highlight-current"),setTimeout(()=>{const n=e.querySelector(".search-highlight-current");n&&n.scrollIntoView({behavior:"smooth",block:"center"})},50))}catch(e){console.error("Failed to update current highlight:",e)}}function Z(e,t,n){const o=e||"<!DOCTYPE html><html><body></body></html>";d.onload=()=>{try{d.contentWindow&&d.contentWindow.document&&(d.contentWindow.document.open(),d.contentWindow.document.write(o),d.contentWindow.document.close())}catch{}},d.srcdoc=o,t!==void 0&&n!==void 0?i("info",`${n.toLocaleString()} words, ${t.toLocaleString()} chars`):i("info",`Loaded ${o.length} chars`)}function se(e){if(W=e||[],!W.length){V.innerHTML='<div class="toc-empty">No headings found</div>';return}let t="";for(const n of W){const o=(n.level-1)*16;t+=`<a href="#${n.id}" class="toc-item toc-level-${n.level}" style="padding-left: ${o}px" data-id="${n.id}">${n.text}</a>`}V.innerHTML=t,V.querySelectorAll(".toc-item").forEach(n=>{n.addEventListener("click",o=>{o.preventDefault();const a=n.dataset.id;try{const s=d.contentWindow.document.getElementById(a);s&&s.scrollIntoView({behavior:"smooth",block:"start"})}catch(s){console.error("Failed to scroll to section:",s)}})})}async function X(){T=!T,p.classList.toggle("visible",T);try{await ke(T)}catch(e){console.error("Failed to save TOC visibility:",e)}}async function le(){S=!S,p.classList.toggle("pinned",S);try{await Te(S)}catch(e){console.error("Failed to save TOC pinned state:",e)}S?(d.style.marginLeft="280px",r&&(r.style.marginLeft="280px")):(d.style.marginLeft="0",r&&(r.style.marginLeft="0")),S?(L.innerHTML=`<svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
      <path d="M9.828.722a.5.5 0 0 1 .354.146l4.95 4.95a.5.5 0 0 1 0 .707l-4.95 4.95a.5.5 0 0 1-.707 0l-4.95-4.95a.5.5 0 0 1 0-.707l4.95-4.95a.5.5 0 0 1 .353-.146z"/>
    </svg>`,L.title="Unpin sidebar"):(L.innerHTML=`<svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
      <path d="M4 9h8v1H4zm0-3h8v1H4zm0-3h8v1H4z"/>
    </svg>`,L.title="Pin sidebar")}function G(){const e=C.value;e==="dark"?(p.classList.add("dark-theme"),p.classList.remove("light-theme"),r==null||r.classList.add("dark-theme"),r==null||r.classList.remove("light-theme")):e==="light"?(p.classList.add("light-theme"),p.classList.remove("dark-theme"),r==null||r.classList.add("light-theme"),r==null||r.classList.remove("dark-theme")):window.matchMedia("(prefers-color-scheme: dark)").matches?(p.classList.add("dark-theme"),p.classList.remove("light-theme"),r==null||r.classList.add("dark-theme"),r==null||r.classList.remove("light-theme")):(p.classList.add("light-theme"),p.classList.remove("dark-theme"),r==null||r.classList.add("light-theme"),r==null||r.classList.remove("dark-theme"))}async function de(){i("info","");try{const e=v.value,t=C.value,n=await be(e,t);if(!n||!n.path)return;if(h=n.path,Y.textContent=h,requestAnimationFrame(()=>{Z(n.html,n.charCount,n.wordCount),se(n.toc),G()}),w&&h)try{await B(h)}catch(o){console.error("Failed to start watching file:",o)}}catch(e){console.error(e),i("error",j(e))}}async function m(){if(!!h){i("info","");try{const e=v.value,t=C.value,n=await Se(h,e,t);requestAnimationFrame(()=>{Z(n.html,n.charCount,n.wordCount),se(n.toc),G(),A&&b.value&&setTimeout(()=>{Q(b.value)},100)})}catch(e){console.error(e),i("error",j(e))}}}q.addEventListener("click",de);Oe.addEventListener("click",X);L.addEventListener("click",e=>{e.stopPropagation(),le()});U.addEventListener("click",async()=>{u=Math.max(50,u-10),E();try{await O(u)}catch(e){console.error(e)}await m()});_.addEventListener("click",async()=>{u=Math.min(200,u+10),E();try{await O(u)}catch(e){console.error(e)}await m()});v.addEventListener("change",async()=>{try{await ae(v.value)}catch(e){console.error(e)}await m()});C.addEventListener("change",async()=>{try{await ie(C.value)}catch(e){console.error(e)}G(),await m()});K.addEventListener("change",async()=>{w=K.checked;try{await xe(w)}catch(e){console.error("Failed to save auto-reload setting:",e)}if(w&&h)try{await B(h),i("Auto-reload enabled")}catch(e){console.error("Failed to start watching file:",e),setError("Failed to enable auto-reload: "+e),K.checked=!1,w=!1}else try{await Ae(),i("Auto-reload disabled")}catch(e){console.error("Failed to stop watching file:",e)}});b.addEventListener("input",e=>{Q(e.target.value)});b.addEventListener("keydown",e=>{e.key==="Enter"?(e.preventDefault(),z(e.shiftKey?"prev":"next")):e.key==="Escape"&&(e.preventDefault(),H())});Fe.addEventListener("click",()=>{z("prev")});De.addEventListener("click",()=>{z("next")});Pe.addEventListener("click",()=>{H()});D.addEventListener("change",async()=>{try{await Le(D.checked)}catch(e){console.error("Failed to save search case sensitivity:",e)}Q(b.value)});async function Ke(){try{J(!1);try{const t=await oe();if(t&&t.length){v.innerHTML="";for(const n of t){const o=document.createElement("option");o.value=n,o.textContent=n,v.appendChild(o)}}}catch(t){console.error(t)}try{const t=await we();t&&(v.value=t)}catch(t){console.error(t)}try{const t=await ge();t&&(C.value=t)}catch(t){console.error(t)}try{const t=await fe();t&&(u=t),E()}catch(t){console.error(t),E()}try{const t=await ue();w=t,K.checked=t}catch(t){console.error(t)}try{const t=await ye();T=t,t&&p.classList.add("visible")}catch(t){console.error(t)}try{const t=await ve();S=t,t&&(p.classList.add("pinned"),d.style.marginLeft="280px",r&&(r.style.marginLeft="280px"),L.innerHTML=`<svg width="14" height="14" viewBox="0 0 16 16" fill="currentColor">
          <path d="M9.828.722a.5.5 0 0 1 .354.146l4.95 4.95a.5.5 0 0 1 0 .707l-4.95 4.95a.5.5 0 0 1-.707 0l-4.95-4.95a.5.5 0 0 1 0-.707l4.95-4.95a.5.5 0 0 1 .353-.146z"/>
        </svg>`,L.title="Unpin sidebar")}catch(t){console.error(t)}try{const t=await pe();D.checked=t}catch(t){console.error(t)}const e=await me();if(!e||e.length<1)return;h=e[0],Y.textContent=h,setTimeout(async()=>{if(await m(),w&&h)try{await B(h)}catch(t){console.error("Failed to start watching file:",t)}},0)}catch(e){console.error(e)}finally{J(!0)}}Z("");E();J(!1);Ke();document.addEventListener("keydown",ze);async function He(){const e=["light","dark","theme"],n=(e.indexOf(C.value)+1)%e.length,o=e[n];C.value=o;try{await ie(o),G(),await m(),i("info",`Palette: ${o} (${c==="metaKey"?"Cmd":"Ctrl"}+Shift+L)`)}catch(a){console.error(a)}}async function Be(){const e=await oe();if(!e||e.length===0)return;const n=(e.indexOf(v.value)+1)%e.length,o=e[n];v.value=o;try{await ae(o),await m(),i("info",`Theme: ${o} (${c==="metaKey"?"Cmd":"Ctrl"}+Shift+T)`)}catch(a){console.error(a)}}function ze(e){if(e.target.tagName==="INPUT"||e.target.tagName==="SELECT")return e.target.id==="searchInput"&&e.key==="Escape",void 0;e.key==="/"&&!e[c]&&!e.shiftKey&&!e.ctrlKey&&!e.altKey?(e.preventDefault(),re(),i("info","Search opened (/)")):e.key==="f"&&e[c]?(e.preventDefault(),re(),i("info",`Search opened (${c==="metaKey"?"Cmd":"Ctrl"}+F)`)):e.key==="F3"?(e.preventDefault(),A&&z("next")):e.key==="Escape"&&A?(e.preventDefault(),H(),i("info","Search closed (Esc)")):e.key==="o"&&e[c]?(e.preventDefault(),de(),i("info",`Opened file (${c==="metaKey"?"Cmd":"Ctrl"}+O)`)):e.key==="r"&&e[c]?(e.preventDefault(),m(),i("info",`Reloaded file (${c==="metaKey"?"Cmd":"Ctrl"}+R)`)):e.key==="t"&&e[c]&&!e.shiftKey?(e.preventDefault(),X(),i("info",`TOC ${T?"shown":"hidden"} (${c==="metaKey"?"Cmd":"Ctrl"}+T)`)):e.key==="p"&&e[c]?(e.preventDefault(),le(),i("info",`TOC ${S?"pinned":"unpinned"} (${c==="metaKey"?"Cmd":"Ctrl"}+P)`)):e.key==="0"&&e[c]?(e.preventDefault(),u=100,E(),O(u),m(),i("info",`Reset font size (${c==="metaKey"?"Cmd":"Ctrl"}+0)`)):(e.key==="="||e.key==="+")&&e[c]?(e.preventDefault(),u=Math.min(200,u+10),E(),O(u),m(),i("info",`Increased font size (${c==="metaKey"?"Cmd":"Ctrl"}+)`)):e.key==="-"&&e[c]?(e.preventDefault(),u=Math.max(50,u-10),E(),O(u),m(),i("info",`Decreased font size (${c==="metaKey"?"Cmd":"Ctrl"}-)`)):e.key==="l"&&e[c]&&e.shiftKey?(e.preventDefault(),He()):e.key==="t"&&e[c]&&e.shiftKey?(e.preventDefault(),Be()):e.key==="Escape"&&(A?(e.preventDefault(),H(),i("info","Search closed (Esc)")):T&&(e.preventDefault(),X(),i("info","Closed TOC (Esc)")))}P("file-open",async e=>{try{const t=Array.isArray(e)?e[0]:e;if(!t)return;if(h=t,Y.textContent=h,await m(),w&&h)try{await B(h)}catch(n){console.error("Failed to start watching file:",n)}}catch(t){console.error(t)}});P("file-changed",async e=>{w&&e===h&&(i("info","File changed, reloading..."),await m())});P("theme-changed",async e=>{w&&(i("info",`Theme changed (${e}), reloading...`),await m())});P("file-watch-error",e=>{console.error("File watch error:",e),i("error","File watch error: "+j(e))});P("status",e=>{if(!e)return;if(typeof e=="string"){i("info",e);return}const t=e.level||"info",n=e.message||"";i(t,n)});
